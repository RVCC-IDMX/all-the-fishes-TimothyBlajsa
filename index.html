<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All The Fishes</title>
    <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">
    <script src="https://pixijs.download/release/pixi.js">
    </script>
</head>

<body style="background-color: rgb(67, 81, 95);">
    <h1></h1>
    <script>

        // Audio event listener
        let audio = document.createElement("audio");
        audio.autoplay = true;
        audio.src = "aquarium.wav";

        document.addEventListener("mousemove", () => {
            audio.play();
        });

        //The App
        var app = new PIXI.Application({
            width: 640,
            height: 400,
            //background: 'img/background.jpg'
            backgroundColor: 0x000000
        });

        //Add view to the document
        document.body.appendChild(app.view);

        //My First Sprite
        let fish1 = PIXI.Sprite.from("img/bigfish.png");

        //Change sprite coordinates
        fish1.x = 420;
        fish1.y = 0;

        //Change sprite size
        fish1.scale.set(.095);

        //Add it to the stage
        app.stage.addChild(fish1);

        //My Second Sprite
        let fish2 = PIXI.Sprite.from("img/smallfish.png");

        //Change sprite2 size
        fish2.scale.set(.07);
        fish2.x = 30;

        //Add it to the stage
        app.stage.addChild(fish2);

        //My background sprite
        let background = PIXI.Sprite.from("img/background.jpg");
        background.scale.set(.7);
        app.stage.addChild(background);

        //My kelp sprite
        let kelp1 = PIXI.Sprite.from("img/kelp.png");
        kelp1.scale.set(.5);
        kelp1.tint = 0x212f55;
        app.stage.addChild(kelp1);

        //My coral sprite
        let coral = PIXI.Sprite.from("img/coral.png");
        coral.x = 300;
        coral.scale.set(.5);
        coral.tint = 0x253152;
        app.stage.addChild(coral);

        //My school sprite
        let school = PIXI.Sprite.from("img/school.png");
        school.tint = 0x090c14;
        school.x = 200;
        school.y = 55;
        school.scale.set(.15);
        app.stage.addChild(school);

        //My second kelp sprite
        let kelp2 = PIXI.Sprite.from("img/kelp.png");
        kelp2.scale.set(.675);
        kelp2.y = .4;
        app.stage.addChild(kelp2);

        //My second coral sprite
        let coral2 = PIXI.Sprite.from("img/coral.png");
        coral2.scale.set(.8);
        coral2.y = 20;
        coral2.x = -400;
        coral2.tint = 0x5676c7;
        app.stage.addChild(coral2);

        //My third fish sprite
        let fish3 = PIXI.Sprite.from("img/betta.png");
        fish3.scale.set(.1);
        fish3.x = 350;
        fish3.y = 50;
        fish3.tint = 0x2e3f6b;
        app.stage.addChild(fish3);

        //My container for the first two fish sprites
        var my_container = new PIXI.Container();
        my_container.addChild(fish1);
        my_container.addChild(fish2);
        my_container.y = 100;
        app.stage.addChild(my_container);

        //My sprite for the bubbles
        let bubble1 = new PIXI.Sprite.from("img/bubble.png");
        bubble1.scale.set(.01);
        app.stage.addChild(bubble1);

        let bubble2 = new PIXI.Sprite.from("img/bubble.png");
        bubble2.scale.set(.01);
        bubble2.x = 80;
        app.stage.addChild(bubble2);

        let bubble3 = new PIXI.Sprite.from("img/bubble.png");
        bubble3.scale.set(.01);
        bubble3.x = 90;
        app.stage.addChild(bubble3);

        let bubble4 = new PIXI.Sprite.from("img/bubble.png");
        bubble4.scale.set(.01);
        bubble4.x = 105;
        app.stage.addChild(bubble4);

        let bubble5 = new PIXI.Sprite.from("img/bubble.png");
        bubble5.scale.set(.01);
        bubble5.x = 550;
        app.stage.addChild(bubble5);

        let bubble6 = new PIXI.Sprite.from("img/bubble.png");
        bubble6.scale.set(.01);
        bubble6.x = 570;
        app.stage.addChild(bubble6);

        let bubble7 = new PIXI.Sprite.from("img/bubble.png");
        bubble7.scale.set(.01);
        bubble7.x = 600;
        app.stage.addChild(bubble7);

        let bubble8 = new PIXI.Sprite.from("img/bubble.png");
        bubble8.scale.set(.01);
        bubble8.x = 610;
        app.stage.addChild(bubble8);

        //My player sprite
        let player = new PIXI.Sprite.from("img/minnow.png");
        player.scale.set(.05);
        //player.anchor.set(0);
        //player.x = app.view.width / 2;
        //player.y = app.view.height / 2;
        player.x = 325;
        player.y = 175;
        //player.interactive = true;
        app.stage.addChild(player);
        
        background.interactive = true;
        background.on('mousedown', moveTo);

        //ANimation loop function
        function animationLoop() {
            let time = Date.now();

            let wobble1 = Math.sin(time / 1000) * 20;
            let wobble2 = Math.cos(time / 1000) * 20;
            let wobble3 = Math.sin(time / 1500) * 20;
            let wobble4 = Math.sin(time / 500) * 5;
            let wobble5 = Math.cos(time / 500) * 5;
            //let sway = Math.sin(time / 1500) * 10;
            let sway2 = Math.cos(time / 1200) * 10;
            let swim = Math.sin(time / 1500) * 1000;

            //fish1.y = wobble1;
           // fish2.y = wobble2;
            //fish3.y = wobble3;
            //kelp1.x = sway;
            //kelp2.x = sway2;
            //school.x = swim;
            //player.y = wobble3;

            //Bubble animations
            bubble1.y = wobble4;
            bubble2.y = wobble5;
            bubble3.y = wobble5;
            bubble4.y = wobble4;

            bubble5.y = wobble5;
            bubble6.y = wobble4;
            bubble7.y = wobble4;
            bubble8.y = wobble5;

            //setTimeout(animationLoop, 1000 / 30);
            requestAnimationFrame(animationLoop);
        }
        animationLoop();

        let Animate = {};

        //animate function
        Animate.to = function(obj,end) {
            return new Promise((resolve,reject) => {

                //initial state for animated objects
                var start = {
                    x : obj.x,
                    y : obj.y
                }

                //set defaults
                if (end.duration == undefined) end.duration = 0;

                var startTime = Date.now();

                function loop(){
                    let ticker = Date.now() - startTime;
                    let delta = ticker/end.duration;

                    //caluclate delta
                    if (delta >= 1){
                        obj.x = end.x;
                        obj.y = end.y;
                        console.log("done");
                        resolve();
                        return;
                    }

                    //interpolation
                    let lerp = (a,b,n) => {
                        return (1 - n) * a + n * b;
                    }

                    obj.x = lerp(start.x,end.x,delta);
                    obj.y = lerp(start.y,end.y,delta);
                    obj.animationID = requestAnimationFrame(loop);
                }

                cancelAnimationFrame(obj.animationID);

                loop();
                //end promise
            });
            
        };

        // stop animation
        Animate.stop = function(obj){
            cancelAnimationFrame(obj.animationID);
        }

        //ease
        Animate.linear = x => x;

        Animate.easeIn = x => x * x;

        Animate.easeOut = x => 1 - (1 - x) * (1 - x);

        Animate.easeInOut = x => x < .5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) /2;

        //pause animation
        function pause(ms){
            return new Promise((resolve,reject)=> {
                setTimeout(resolve,ms);
            });
        }

        //idle animations
        //animate fish1
        async function idleSwim1() {
            await Animate.to(fish1,{
                x:420,y:20,
                duration:3000,
                //easing:Animate.easeInOut
            });
            await Animate.to(fish1,{
                x:420,y:50,
                duration:2000,
                //easing:Animate.easeInOut
            });
            //await console.log("promise execute");
            
            idleSwim1();
        }
        idleSwim1();

        //animate fish2
        async function idleSwim2() {
            await Animate.to(fish2,{
                x:30,y:20,
                duration:2000,
                easing:Animate.easeInOut
            });
            fish2.tint = (Math.floor(Math.random() * 0xFFFFFF));
            await Animate.to(fish2,{
                x:30,y:60,
                duration:2000,
                easing:Animate.easeInOut
            });
            idleSwim2();
        }
        idleSwim2();

        //animate fish3
        async function idleSwim3(){
            await Animate.to(fish3,{
                x:350,y:0,
                duration:3000,
                easing:Animate.easeInOut
            });
            await fish3.scale.set(.1);
            await Animate.to(fish3,{
                x:350,y:20,
                duration:3000,
                easing:Animate.easeInOut
            });
            idleSwim3();
        }
        idleSwim3();

        async function backgroundFish(){
            await Animate.to(school,{
                x:-1000,y:55,
                duration:3000,
            });
            await school.scale.set(.25);
            await school.alpha == .95;
            await Animate.to(school,{
                x:2000,y:55,
                duration:2100,
            });
            await school.scale.set(.10);
            backgroundFish();
        }
        backgroundFish();

        //animate kelp
        async function sway(){
            await Animate.to(kelp1,{
                x:50,y:0,
                duration:5000,
                easing:Animate.easeInOut
            });
            await Animate.to(kelp1,{
                x:20,y:0,
                duration:5000,
                easing:Animate.easeInOut
            });
            sway();
        }
        sway();
        async function sway2(){
            await Animate.to(kelp2,{
                x:50,y:0,
                duration:4000,
                easing:Animate.easeInOut
            });
            await Animate.to(kelp2,{
                x:30,y:0,
                duration:4000,
                easing:Animate.easeInOut
            });
            sway2();
        }
        sway2();

        // function makeColor(){
        //     let randomColor = Math.floor(Math.random() * 0xFFFFFF);
        //     return randomColor;
        // }
        // makeColor();
        // console.log(randomColor);
        

        
        
        

        async function playerIdle(){
            await Animate.to(player,{
                x: 325,
                y: 150,
                duration: 3000,
                easing:Animate.easeInOut
            })
            //await pause(2000);
            await Animate.to(player,{
                x: 325,
                y: 200,
                duration: 3000,
                easing:Animate.easeInOut
            })
            playerIdle()
        }
        playerIdle()

        async function moveTo(e, data){
            //player.position.x = e.data.global.x;
            //player.position.y = e.data.global.y;
            await Animate.to(player,{
                x: e.data.global.x,
                y: e.data.global.y,
                duration:2000,
                easing:Animate.easeInOut
            });
            await pause(400);
             player.width = 20;
             await pause(100);
             player.width = 45.6;
            moveTo();
            
            playerIdle();
           
        }
        moveTo();
        //playerIdle();

        function rotation(){
            player.rotation += .05;
        }

        //Player mouse interaction
        // player.dragging = false;
        // player.on("pointerdown", e => {
        //     player.dragging = true;
        //     //console.log("clicked");
        // })
        // player.on("pointermove", e => {
        //     if (player.dragging) {
        //        //console.log("dragging");
        //         player.x = e.data.global.x;
        //         player.y = e.data.global.y;
        //     };
        // })
        // player.on("pointerup", e => {
        //     player.dragging = false;
        // })
        // player.on("pointerupoutside", e => {
        //     player.dragging = false;
        // })

        // Color changing button logic
        // let ourButton = new PIXI.Container();
        // ourButton.interactive = true;

        // let buttonBody = new PIXI.Graphics();
        // buttonBody.beginFill(0xEEEEEE);
        // buttonBody.drawRoundedRect(0, 0, 100, 50);
        // buttonBody.alpha = .7;
        // ourButton.addChild(buttonBody);

        // ourButton.body = buttonBody;

        // let buttonText = new PIXI.Text('Colors');
        // buttonText.anchor.set(.5, .5);
        // buttonText.x = 50;
        // buttonText.y = 25;
        // ourButton.addChild(buttonText);
        // ourButton.text = buttonText;

        // // Add event listeners for color changing button
        // // Click state
        // ourButton.on("pointerdown", e => {
        //     let randomColor = Math.floor(Math.random() * 0xFFFFFF);
        //     fish2.tint = randomColor;
        //     buttonBody.tint = randomColor;
        //     buttonText.text = randomColor.toString(16);
        //     //console.log(randomColor);
        //     //console.log("clicked");
        // });

        // app.stage.addChild(ourButton);

        // // Begin Slide logic
        // function makeSlider() {
        //     let slideContain = new PIXI.Container();
        //     slideContain.interactive = true;
        //     slideContain.value = 0;

        //     let track = new PIXI.Graphics();
        //     track.beginFill(0xCCCCCC);
        //     track.drawRoundedRect(200, -10, 300, 20);
        //     track.alpha = .7;

        //     slideContain.addChild(track);

        //     let slide = new PIXI.Graphics();
        //     slide.interactive = true;
        //     slide.beginFill(0xEEEEEE);
        //     slide.drawRoundedRect(175, -25, 50, 50);
        //     slide.alpha = .95;

        //     slideContain.addChild(slide);

        //     // Listeners for dragging interaction
        //     slide.dragging = false;
        //     slide.on("pointerdown", e => {
        //         slide.dragging = true;
        //         //console.log('click');
        //     });

        //     slide.on("pointermove", e => {
        //         if (slide.dragging) {
        //             let newX = e.data.global.x - slideContain.getGlobalPosition().x - 200;
        //             let newY = e.data.global.y - slideContain.getGlobalPosition().y;

        //             if (newX > track.width) newX = track.width;
        //             if (newX < 0) newX = 0;

        //             slideContain.value = newX / track.width;
        //             slide.x = newX;
        //             fish1.scale.set(newX / 1200);
        //             //console.log(slideContain.value);
        //         }
        //     });
        //     slide.on("pointerup", e => {
        //         slide.dragging = false;
        //     });
        //     slide.on("pointerupoutside", e => {
        //         slide.dragging = false;
        //     });
        //     return slideContain;
        // };

        // // Add slider to stage
        // let slideContain = makeSlider();
        // app.stage.addChild(slideContain);

    </script>
    <p>by Timothy Blajsa</p>
</body>

</html>